---           
layout: post
title: State Machine
date: Sun Mar 06 09:31:00 UTC 2011
comments: false
categories: State Machine plugin rails
---

<div dir="ltr" style="text-align: left;" trbidi="on">In some application we need to track the state of a model. For example, a user requested for signup. Admin has to approve the user for the user to login. Admin has the option to reject the user also. So the status of the user model will be in one of the following states [pending, approved, rejected].<br /><br />The famous plugin used for tracking the state is <a href="https://github.com/rubyist/aasm">aasm</a>. You can install Acts as state machine using:<br /><br /><span class="Apple-style-span" style="color: #990000; font-family: 'Courier New', Courier, monospace;">sudo gem install aasm</span><br /><br />Then in the user model you have to include the plugin<br /><br /><span class="Apple-style-span" style="color: #990000; font-family: 'Courier New', Courier, monospace;">include AASM</span><br /><br />Then specify which field you want to use as the state.<br /><br /><span class="Apple-style-span" style="color: #990000; font-family: 'Courier New', Courier, monospace;">aasm_column :status</span><br /><br />Now you can write the states of the model:<br /><br /><span class="Apple-style-span" style="color: #990000; font-family: 'Courier New', Courier, monospace;">aasm_state :pending&nbsp;</span><br /><span class="Apple-style-span" style="color: #990000; font-family: 'Courier New', Courier, monospace;">aasm_state :approved&nbsp;</span><br /><span class="Apple-style-span" style="color: #990000; font-family: 'Courier New', Courier, monospace;">aasm_state :rejected</span><br /><br />You can set initial state using:<br /><br /><span class="Apple-style-span" style="color: #990000; font-family: 'Courier New', Courier, monospace;">aasm_initial_state :pending</span><br /><br />Now we need the events to change the state:<br /><br /><span class="Apple-style-span" style="color: #990000; font-family: 'Courier New', Courier, monospace;">aasm_event :approve do</span><br /><span class="Apple-style-span" style="color: #990000; font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp;transitions :to =&gt; :approved, :from =&gt; [:pending]</span><br /><span class="Apple-style-span" style="color: #990000; font-family: 'Courier New', Courier, monospace;">end</span><br /><span class="Apple-style-span" style="color: #990000; font-family: 'Courier New', Courier, monospace;"><br /></span><br /><span class="Apple-style-span" style="color: #990000; font-family: 'Courier New', Courier, monospace;">aasm_event :reject do</span><br /><span class="Apple-style-span" style="color: #990000; font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp;transitions :to =&gt; :rejected, :from =&gt; [:pending]</span><br /><span class="Apple-style-span" style="color: #990000; font-family: 'Courier New', Courier, monospace;">end</span><br /><br />This is all we need in model.<br /><br />Now to change the state of the model object you can use:<br /><br /><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;"><span class="Apple-style-span" style="color: #990000;">user.approve!</span> </span>&nbsp;#To approve the user<br /><span class="Apple-style-span" style="color: #990000; font-family: 'Courier New', Courier, monospace;">user.reject!</span> &nbsp; &nbsp; &nbsp;#To reject the user<br /><br />If you want to do something while the state of the model is change from one state to another you can call the method at the time of state change using:<br /><br /><span class="Apple-style-span" style="color: #990000; font-family: 'Courier New', Courier, monospace;">aasm :approved, :enter =&gt; entered_to_apporoved, :exit =&gt; exit_from_approved</span><br /><br />At the time of state definition you can specify the enter method and exit method to call.<br /><br /><br /></div><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/7585462888260154580-4582293218607317697?l=abhionrails.blogspot.com' alt='' /></div>