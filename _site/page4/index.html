<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <title>Abhi On Rails</title>
  <meta name="author" content="Abhilash M A" />

  <!-- syntax highlighting CSS -->
  <link rel="stylesheet" href="/css/syntax-highlight.css" type="text/css" />
  
  <!-- Homepage CSS -->
  <link rel="stylesheet" href="/css/screen-projection.css" type="text/css" media="screen, projection" />
  
  <link rel="stylesheet" href="/css/application.css" type="text/css" />

  <link rel="icon" type="image/ico" href="/ruby-icon.ico" />
   <!--[if lte IE 8]>
   <script type="text/javascript">
     // Create elements here allows IE8 to style them when it sees the real thing.
     document.createElement('article');
     document.createElement('aside');
     document.createElement('footer');
     document.createElement('header');
     document.createElement('hgroup');
     document.createElement('menu');
     document.createElement('nav');
     document.createElement('section');
   </script>
   <![endif]-->
   <script type="text/javascript">var
     switchTo5x=true;
   </script>
   <script type="text/javascript" src="http://w.sharethis.com/button/buttons.js">
   </script>
   <script type="text/javascript">stLight.options({publisher:'21abf337-23b8-4364-b61a-87c7c2e65d83'});</script>
</head>
<body>

<div class="site">
  <div class="posts left-section">
    <div class="title">
      <h1><a href="/">Abhi On Rails</a></h1>
      <div class="title-desc">Ruby On Rails - What I learned recently</div>
    </div>
    
    
<article class="excerpt">
<header>
<time datetime="2011-02-01" pubdate="pubdate" class="post-date">
Feb 01, 2011
</time>
<h1><a href="/through/models/assoications/2011/02/01/through-association/">through association</a></h1>
</header>

<div dir="ltr" style="text-align: left;" trbidi="on">There are many associations in Rails, like one-to-one, one-to-many, many-to-many. You can associate a model to another using any of these associations. So what is 'through' association?<br /><br />Take an example of three models: teacher, student, subject<br /><br /><script src="https://gist.github.com/1298824.js?file=association.rb"></script><br />There is no direct association between teacher and student. So using through you can create association between teacher and student models.<br /><br /><script src="https://gist.github.com/1298834.js?file=through_association.rb"></script><span class="Apple-style-span" style="color: #990000; font-family: 'Courier New', Courier, monospace;"><br /></span></div><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/7585462888260154580-1538085144951876139?l=abhionrails.blogspot.com' alt='' /></div>
<div class="share-this">
<span  class='st_email_hcount' displayText='Email' st_url="http://abhidsm.github.com/through/models/assoications/2011/02/01/through-association/" st_title="through association"></span>
<span  class='st_twitter_hcount' displayText='Tweet' st_url="http://abhidsm.github.com/through/models/assoications/2011/02/01/through-association/" st_title="through association #abhidsm"></span>
<span  class='st_facebook_hcount' displayText='Facebook' st_url="http://abhidsm.github.com/through/models/assoications/2011/02/01/through-association/" st_title="through association"></span>
<span  class='st_fblike_hcount' st_url="http://abhidsm.github.com/\/through/models/assoications/2011/02/01/through-association/" st_title="through association"></span>
<span  class='st_plusone_hcount' st_url="http://abhidsm.github.com/through/models/assoications/2011/02/01/through-association/" st_title="through association"></span>
</div>

<p class="full-post"><a class="small" href="/through/models/assoications/2011/02/01/through-association/#disqus_thread">comments...</a></p>
</article>
<div class="separator">
<image src="/images/blog-post-separator.png" />
</div>

<article class="excerpt">
<header>
<time datetime="2011-01-27" pubdate="pubdate" class="post-date">
Jan 27, 2011
</time>
<h1><a href="/background/process/whenever/cron/job/rails/2011/01/27/Cron-Job/">Cron Job</a></h1>
</header>

<div dir="ltr" style="text-align: left;" trbidi="on">Cron is a time based job scheduler. Cron job is a job scheduled to run at particular time. In rails you may need to create cron jobs in many situations. For example send account expiration mail, check account balance and inform the user, etc. There is a gem&nbsp;'Whenever',&nbsp;which allows you to create a cron job.<br /><br /><a href="https://github.com/javan/whenever">Whenever</a><br /><br />Using whenever you can easily create cron jobs. First you have to install the gem:<br /><div style="text-align: left;"><span class="Apple-style-span" style="color: #990000; font-family: 'Courier New', Courier, monospace;">gem install whenever</span></div><div style="text-align: left;"><br /></div><div style="text-align: left;">Then from your application path type:</div><div style="text-align: left;"><span class="Apple-style-span" style="color: #990000; font-family: 'Courier New', Courier, monospace;">whenevrize .</span></div>This will create the file 'config/schedule.rb'.<br /><br />In scedule.rb file you can write your cron job:<br /><span class="Apple-style-span" style="color: #990000; font-family: 'Courier New', Courier, monospace;">every 1.day, :at =&gt; '12:00 AM' do</span><br /><span class="Apple-style-span" style="color: #990000; font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp; runner "Model.method"</span><br /><span class="Apple-style-span" style="color: #990000; font-family: 'Courier New', Courier, monospace;">end&nbsp;</span><br />this will run the method inside the Model everyday at 12:00 AM.<br /><span class="Apple-style-span" style="color: orange;"><br /></span><br />For more details visit <a href="https://github.com/javan/whenever">GitHub</a><br /><br /></div><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/7585462888260154580-4475212885404274660?l=abhionrails.blogspot.com' alt='' /></div>
<div class="share-this">
<span  class='st_email_hcount' displayText='Email' st_url="http://abhidsm.github.com/background/process/whenever/cron/job/rails/2011/01/27/Cron-Job/" st_title="Cron Job"></span>
<span  class='st_twitter_hcount' displayText='Tweet' st_url="http://abhidsm.github.com/background/process/whenever/cron/job/rails/2011/01/27/Cron-Job/" st_title="Cron Job #abhidsm"></span>
<span  class='st_facebook_hcount' displayText='Facebook' st_url="http://abhidsm.github.com/background/process/whenever/cron/job/rails/2011/01/27/Cron-Job/" st_title="Cron Job"></span>
<span  class='st_fblike_hcount' st_url="http://abhidsm.github.com/\/background/process/whenever/cron/job/rails/2011/01/27/Cron-Job/" st_title="Cron Job"></span>
<span  class='st_plusone_hcount' st_url="http://abhidsm.github.com/background/process/whenever/cron/job/rails/2011/01/27/Cron-Job/" st_title="Cron Job"></span>
</div>

<p class="full-post"><a class="small" href="/background/process/whenever/cron/job/rails/2011/01/27/Cron-Job/#disqus_thread">comments...</a></p>
</article>
<div class="separator">
<image src="/images/blog-post-separator.png" />
</div>

<article class="excerpt">
<header>
<time datetime="2011-01-23" pubdate="pubdate" class="post-date">
Jan 23, 2011
</time>
<h1><a href="/delayed/jobs/background/process/plugin/rails/2011/01/23/Delayed-Job/">Delayed Job</a></h1>
</header>

<div dir="ltr" style="text-align: left;" trbidi="on">Delayed Job is a plugin used to execute long running jobs in background. For example, downloads, uploads, external interactions etc. And you can also specify when to start a delayed job.<br /><br />To install delayed_job plugin:<br /><br /><span class="Apple-style-span" style="color: #990000; font-family: 'Courier New', Courier, monospace;">script/plugin install git://github.com/tobi/delayed_job.git</span><br /><br />After installation you need to create a table for the delayed job to save the jobs.<br /><br /><span class="Apple-style-span" style="color: #990000; font-family: 'Courier New', Courier, monospace;">script/generate migration create_table_for_delayed_job</span><br /><br />And add the following script to the migration file.<br /><br /><span class="Apple-style-span" style="color: #990000; font-family: 'Courier New', Courier, monospace;">class CreateTableForDelayedJob &lt; ActiveRecord::Migration<br />&nbsp;&nbsp; &nbsp;def self.up<br />&nbsp;&nbsp; &nbsp; &nbsp; create_table :delayed_jobs, :force =&gt; true do |t|<br />&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;t.integer  :priority, :default =&gt; 0<br />&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;t.integer  :attempts, :default =&gt; 0<br />&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;t.text     :handler<br />&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;t.text     :last_error<br />&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;t.datetime :run_at<br />&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;t.datetime :locked_at<br />&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;t.datetime :failed_at<br />&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;t.string   :locked_by<br />&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;t.timestamps<br />&nbsp;&nbsp; &nbsp; &nbsp; end<br />&nbsp;&nbsp; &nbsp;end<br /><br />&nbsp;&nbsp; &nbsp;def self.down<br />&nbsp;&nbsp; &nbsp; &nbsp; drop_table :delayed_jobs<br />&nbsp;&nbsp; &nbsp;end<br />end</span><br /><i><b><br /></b></i><br />Now run the migration:<br /><br /><span class="Apple-style-span" style="color: #990000; font-family: 'Courier New', Courier, monospace;">rake db:migrate</span><br /><i><b><br /></b></i><br />To add a job to delayed_job you can use the enqueue method of Delayed Job. First you have to create a Job Class, for example we need to send a notification mail using delayed job. Then we create a lib file with the content:<br /><br /><span class="Apple-style-span" style="color: #990000; font-family: 'Courier New', Courier, monospace;">Class DelayedNotificationMail</span><br /><span class="Apple-style-span" style="color: #990000; font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp; attr_accessor :id</span><br /><span class="Apple-style-span" style="color: #990000; font-family: 'Courier New', Courier, monospace;"><br /></span><br /><span class="Apple-style-span" style="color: #990000; font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp; def initialize(id)</span><br /><span class="Apple-style-span" style="color: #990000; font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp; &nbsp; &nbsp;self.id = id</span><br /><span class="Apple-style-span" style="color: #990000; font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp; end</span><br /><span class="Apple-style-span" style="color: #990000; font-family: 'Courier New', Courier, monospace;"><br /></span><br /><span class="Apple-style-span" style="color: #990000; font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp; def perform</span><br /><div style="text-align: left;"><span class="Apple-style-span" style="color: #990000; font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; &nbsp;UserMailer.deliver_notification_mail (User.find(id))</span></div><span class="Apple-style-span" style="color: #990000; font-family: 'Courier New', Courier, monospace;">&nbsp;&nbsp; end</span><br /><span class="Apple-style-span" style="color: #990000; font-family: 'Courier New', Courier, monospace;">end</span><br /><br />Now we can add job to the delayed_job using:<br /><br /><span class="Apple-style-span" style="color: #990000; font-family: 'Courier New', Courier, monospace;">Delayed::Job.enqueue DelayedNotificationMail.new(@user_id), 0, 1.hour.from_now</span><br /><b><i><br /></i></b><br />To run the jobs in background you have to execute the rake task:<br /><b><i><br /></i></b><br /><span class="Apple-style-span" style="color: #990000; font-family: 'Courier New', Courier, monospace;">rake jobs:work</span><br /><b><i><br /></i></b><br />This will start a process which will run the jobs in the queue, and will run the job according to the delay specified in the job.<br /><br />To clear all the jobs in queue you can use the rake task:<br /><br /><span class="Apple-style-span" style="color: #990000; font-family: 'Courier New', Courier, monospace;">rake jobs:clear</span><br /><br />For more details you can go to the <a href="https://github.com/tobi/delayed_job">GitHub</a><br /><br /></div><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/7585462888260154580-980501115402390831?l=abhionrails.blogspot.com' alt='' /></div>
<div class="share-this">
<span  class='st_email_hcount' displayText='Email' st_url="http://abhidsm.github.com/delayed/jobs/background/process/plugin/rails/2011/01/23/Delayed-Job/" st_title="Delayed Job"></span>
<span  class='st_twitter_hcount' displayText='Tweet' st_url="http://abhidsm.github.com/delayed/jobs/background/process/plugin/rails/2011/01/23/Delayed-Job/" st_title="Delayed Job #abhidsm"></span>
<span  class='st_facebook_hcount' displayText='Facebook' st_url="http://abhidsm.github.com/delayed/jobs/background/process/plugin/rails/2011/01/23/Delayed-Job/" st_title="Delayed Job"></span>
<span  class='st_fblike_hcount' st_url="http://abhidsm.github.com/\/delayed/jobs/background/process/plugin/rails/2011/01/23/Delayed-Job/" st_title="Delayed Job"></span>
<span  class='st_plusone_hcount' st_url="http://abhidsm.github.com/delayed/jobs/background/process/plugin/rails/2011/01/23/Delayed-Job/" st_title="Delayed Job"></span>
</div>

<p class="full-post"><a class="small" href="/delayed/jobs/background/process/plugin/rails/2011/01/23/Delayed-Job/#disqus_thread">comments...</a></p>
</article>
<div class="separator">
<image src="/images/blog-post-separator.png" />
</div>

<div class="blog-nav">
  
  <div class="blog-prev">
    
    <a class="small" href="/page3">Newer &gt;&gt;</a>
    
  </div>
  
  
  <div class="blog-next">
    <a class="small" href="/page5">&lt;&lt; Older</a>
  </div>
  
  <hr />
</div>




    
    <div class="footer">
      <div class="contact">
        <p>
          Abhilash M A<br />
        abhidsm@gmail.com
        </p>
      </div>
      <div class="contact">
        <p>
          <a href="http://github.com/abhidsm/">github.com/abhidsm</a><br />
        <a href="http://twitter.com/abhidsm/">twitter.com/abhidsm</a><br />
        </p>
      </div>
      <div class="copy-right">
        Copyright © 2011 Abhilash M A. Powered by <a target="_new"
        href="http://github.com/mojombo/jekyll">Jekyll</a>
        and <a target="_new" href="http://github.com">Github</a>.
      </div>
    </div>
  </div>
  <div class="right-section">
    <div class="home margin-top-10"><a href="/">Home</a></div>
    <div class="archive margin-top-10"><a href="/archive">Archive</a></div>
    <div class="about margin-top-10"><a target="_new" href="http://about.me/abhidsm">About</a></div>
    <div class="working-with-rails-badge margin-top-10">
      <a href="http://www.workingwithrails.com/recommendation/new/person/20833-abhilash-m-a"><img alt="Recommend Me" src="http://workingwithrails.com/images/tools/compact-med.jpg" /></a>
    </div>
<!--    <div class="work margin-top-10"> 
      <ul>Working At
        <li><a target="_new" href="http://www.multunus.com">Multunus Software Pvt. Ltd.</a></li>
      </ul>
    </div> -->
    <div class="one-more-blog margin-top-10"> 
      <ul>I have one more blog
        <li><a target="_new" href="http://abhidsm.com">Abhi's Experiments</a></li>
      </ul>
    </div>
    <div class="spare-time-apps margin-top-10"> 
      <ul>My Spare-Time Apps
        <li><a target="_new" href="http://flamesgame.appspot.com">Flames Game</a></li>
        <li><a target="_new" href="http://justchat.nodester.com">Just Chat</a></li>
      </ul>
    </div>
    <div class="friends margin-top-10"> 
      <ul>Blogs of my Friends
        <li><a target="_new" href="http://foobarnbaz.com/">Sreejith K</a></li>
        <li><a target="_new" href="http://manuknkra.wordpress.com/">Manu K Mohan</a></li>
      </ul>
    </div>
    <div class="following margin-top-10"> 
      <ul>I am following the following:
        <li><a target="_new" href="http://news.ycombinator.com/">Hacker News</a></li>
        <li><a target="_new" href="http://techcrunch.com/">Tech Crunch</a></li>
        <li><a target="_new" href="http://www.techmeme.com/">Tech Meme</a></li>
      </ul>
    </div>
  </div>
</div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'abhidsm'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>
